<?xml version="1.0" encoding="utf-8"?>

<odoo>
    <data>
        <record model="ir.actions.act_window" id="hrv3_action_history_action_window">
            <field name="name">Action History</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">hr.infraction.action_history</field>
            <field name="view_mode">tree,form</field>
            <field name="view_type">form</field>
        </record>



        <record id="hrv3_action_history_tree" model="ir.ui.view">
            <field name="name">Action History List</field>
            <field name="model">hr.infraction.action_history</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <field name="stage"/>
                <field name="corrective_action"/>
                <field name="emp_id" force_save="1" readonly="1" groups="base.group_no_one"/>
                <field name="infraction_id" force_save="1" readonly="1" groups="base.group_no_one"/>
                <field name="offense_code_id" igroups="base.group_no_one"/>
                <field name="start_date" force_save="1" readonly="1" string="Date Executed"/>
                <field name="end_date" force_save="1" readonly="1" string="End Date"/>
                <field name="duration"/>
                <field name="days_remaining"/>
            </field>
        </record>


        <record id="hrv3_action_history_form" model="ir.ui.view">
            <field name="name">Action History Form</field>
            <field name="model">hr.infraction.action_history</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form action="">
                    <header>

                    </header>
                    <sheet>
                        <group>
                            <group>
                                <field name="stage" required="1" attrs="{'readonly': [('infraction_state','in',('for_closure','closed'))]}"/>
                                <field name="user_id"/>
                                <field name="emp_id" groups="base.group_no_one"/>
                                <field name="infraction_id" readonly="1" groups="base.group_no_one"/>
                                <field name="offense_code_id" groups="base.group_no_one"/>
                                <field name="action" groups="base.group_no_one" force_save="1" readonly="1" />
                                <field name="offense_frequency" attrs="{'invisible': [('stage','not in',('corrective_action'))]}"/>
                                <field name="corrective_action" attrs="{'readonly': [('stage','in',('incident_report','collaboration'))], 'invisible': [('stage','not in',['incident_report','collaboration','corrective_action'])], 'required': [('stage','in',['corrective_action'])]}" />
                                <field name="number_of_days" attrs="{'invisible': ['|',('stage','not in',('corrective_action')),('action','not in',['Suspension'])]}"/>
                                <field name="violation_id" attrs="{'invisible': [('stage','not in',('inv_nte_issuance'))]}" force_save="1" readonly="1"/>
                                <field name="attachment" attrs="{'invisible': [('stage','not in',('incident_report', 'inv_nte_issuance', 'collaboration'))]}" />
                                <field name="infraction_state" base="group_no_one"/>
                                <label for="submit_nte" attrs="{'invisible': [('stage','not in',('inv_nte_issuance'))]}"/>
                                <div class="o_row" attrs="{'invisible': [('stage','not in',('inv_nte_issuance'))]}">
                                    <field name="submit_nte" attrs="{'invisible': [('stage','not in',('inv_nte_issuance'))]}"/>
                                    <span>
                                        <button name="send_nte_email" type="object" class="btn-primary" string="Send NTE" attrs="{'invisible': [('submit_nte','!=',True)]}" />
                                    </span>
                                </div>
                                <label for="staggered" attrs="{'invisible': ['|',('action','not in',['Suspension'], ), ('stage','not in',['corrective_action'])]}"/>
                                <div class="o_row" attrs="{'invisible': ['|',('action','not in',['Suspension'], ), ('stage','not in',['corrective_action'])], 'readonly': [('action','not in',['Suspension']),('stage','not in',['corrective_action'])]}">
                                    <field name="staggered" attrs="{'invisible': ['|',('action','not in',['Suspension']), ('stage','not in',['corrective_action'])], 'readonly': [('action','not in',['Suspension']),('stage','not in',['corrective_action'])]}" nolabel="1"/>
                                    <span>
                                        <button name="%(hrms_compliance.create_suspension_wizard)d" string="Use Suspension" type="action" class="btn-primary" attrs="{'invisible': ['|',('staggered','=',False), ('action','not in',['Suspension'])], 'readonly':[('staggered','=',False)]}" context="{'default_suspension_days': number_of_days, 'default_emp_id':emp_id, 'default_infraction_id': infraction_id}" />
                                    </span>
                                </div>
                            </group>
                            <group>
                                <field name="start_date" attrs="{'readonly': [('infraction_state','in',('for_closure','closed'))]}"/>
                                <field name="end_date" attrs="{'readonly': [('infraction_state','in',('for_closure','closed'))]}"/>
                            </group>
                        </group>
                        <group>
                            <field name="notes" attrs="{'readonly': [('infraction_state','in',('for_closure','closed'))]}"/>
                        </group>
                    </sheet>
                </form>

            </field>
        </record>

        
        <record id="action_history_access" model="res.groups">
            <field name="name">Action History Access</field>
        </record>
        

        <record id="action_history_uneditable_on_forclosure" model="ir.rule">
            <field name="name">Action History Uneditable on For Closure</field>
            <field name="model_id" ref="hrms_compliance.model_hr_infraction_action_history"/>
            <field name="groups" eval="[(4, ref('base.group_user'))]"/>
            <field name="perm_read" eval="0"/>
            <field name="perm_write" eval="1"/>
            <field name="perm_create" eval="1"/>
            <field name="perm_unlink" eval="1"/>
            <!-- <field name="domain_force">
                ['|',('infraction_state','in',['for_closure']),('infraction_state','in',['closed'])]
            </field> -->
        </record>
    </data>
</odoo>
